#N canvas 61 23 584 889 10;
#X obj 12 19 cnv 15 100 10 empty empty fluid.nmfmatch~ 20 12 0 36 -262144
-66577 0;
#X text 457 719 more info:;
#X text 36 57 Real-Time Non-Negative Matrix Factorisation with Fixed
Bases, f 61;
#N canvas 0 22 450 278 (subpatch) 0;
#X array didact-source3 88200 float 0;
#X coords 0 1 88199 -1 516 141 1 0 0;
#X restore 35 160 graph;
#N canvas 731 210 608 628 make_2_tones 0;
#X msg 38 172 44100;
#X obj 57 220 until;
#X msg 125 241 -1;
#X msg 57 241 1;
#X obj 57 262 +;
#X obj 57 283 t f f f f f, f 40;
#X obj 297 310 expr sin($f1 / 22050 * 3.14159 * 5000);
#X obj 38 193 t b f b;
#X obj 38 402 fluid.bufcompose~;
#X obj 38 153 loadbang;
#X obj 57 308 expr sin($f1 / 22050 * 3.14159 * 500);
#X obj 39 81 array define lowsine3 44100;
#X obj 39 101 array define hisine3 44100;
#X obj 57 329 tabwrite lowsine3;
#X obj 297 331 tabwrite hisine3;
#X msg 38 422 \; didact-source3 xticks 0 0 0;
#X msg 38 365 reset \, destgain 1 \, destination didact-source3 \,
source lowsine3 \, bang \, source hisine3 \, deststartframe 44100 \,
bang;
#X connect 0 0 7 0;
#X connect 1 0 3 0;
#X connect 2 0 4 1;
#X connect 3 0 4 0;
#X connect 4 0 5 0;
#X connect 5 0 10 0;
#X connect 5 1 13 1;
#X connect 5 2 6 0;
#X connect 5 3 14 1;
#X connect 5 4 4 1;
#X connect 6 0 14 0;
#X connect 7 0 16 0;
#X connect 7 1 1 0;
#X connect 7 2 2 0;
#X connect 8 0 15 0;
#X connect 9 0 0 0;
#X connect 10 0 13 0;
#X connect 16 0 8 0;
#X restore 35 313 pd make_2_tones;
#N canvas 0 22 450 278 (subpatch) 0;
#X array nmfmatch_basis-0 513 float 0;
#X coords 0 1 512 0 513 70 1 0 0;
#X restore 38 526 graph;
#N canvas 0 22 450 278 (subpatch) 0;
#X array nmfmatch_basis-1 513 float 0;
#X coords 0 1 512 0 513 70 1 0 0;
#X restore 37 611 graph;
#X obj 37 380 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144 -1
-1;
#X text 65 379 1) decompose the 2 consecutive sines above in 2 components
with bufnmf~, f 74;
#X text 35 494 2) watch for clearly different bases - ideally a spike
each.;
#X obj 36 727 osc~ 500;
#X obj 157 726 osc~ 5000;
#X obj 36 765 *~;
#X obj 64 749 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X obj 157 765 *~;
#X obj 185 749 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X obj 36 801 *~ 0.1;
#X obj 36 822 dac~;
#N canvas 280 113 678 815 example_1 0;
#X obj 20 133 soundfiler;
#X obj 20 153 t b;
#N canvas 0 23 909 774 statsquery 0;
#X obj 118 150 list split 1;
#X obj 212 156 list length;
#X obj 152 170 t a;
#X obj 117 256 +;
#X msg 117 223 -1;
#X obj 215 300 tabread;
#X obj 117 202 t b b f;
#X msg 215 278 5;
#X obj 156 375 spigot;
#X obj 119 429 f;
#X obj 117 277 t f f f, f 14;
#X obj 117 298 sel 0;
#X obj 118 100 t a a b, f 38;
#X obj 230 409 spigot;
#X obj 215 321 t f f;
#X obj 118 54 inlet;
#X text 163 61 the channels where the centroids are= the first of every
7 (see fluid.bufstats~ help), f 85;
#X msg 118 79 0 7 14 21 28 35 42 49 56 63;
#X text -4 153 iterates backwards;
#X text 18 241 keeps the index;
#X text 269 301 reads the index of the median stats;
#X text 278 407 compares it- passes if larger \, and also stores the
index;
#X obj 119 450 outlet;
#X text 119 473 output the index of the largest;
#X msg 245 277 set nmfmatch_guit-stats-\$1;
#X obj 243 351 >;
#X msg 375 320 -1;
#X connect 0 0 6 0;
#X connect 0 1 2 0;
#X connect 1 0 3 1;
#X connect 2 0 0 0;
#X connect 3 0 10 0;
#X connect 4 0 3 0;
#X connect 5 0 14 0;
#X connect 6 0 4 0;
#X connect 6 1 7 0;
#X connect 6 2 24 0;
#X connect 7 0 5 0;
#X connect 8 0 9 1;
#X connect 9 0 22 0;
#X connect 10 0 11 0;
#X connect 10 1 8 0;
#X connect 10 2 3 1;
#X connect 11 0 9 0;
#X connect 12 0 0 0;
#X connect 12 1 1 0;
#X connect 12 2 26 0;
#X connect 13 0 25 1;
#X connect 14 0 13 0;
#X connect 14 1 25 0;
#X connect 15 0 17 0;
#X connect 17 0 12 0;
#X connect 24 0 5 0;
#X connect 25 0 8 1;
#X connect 25 0 13 1;
#X connect 26 0 9 1;
#X connect 26 0 25 1;
#X restore 20 256 pd statsquery;
#N canvas 329 66 450 472 makenewbases 0;
#X obj 16 26 inlet;
#X obj 17 282 outlet;
#X obj 195 218 sel;
#X obj 162 257 f;
#X msg 16 68 10;
#X obj 16 89 t f b;
#X obj 16 156 +;
#X msg 79 130 -1;
#X obj 16 110 until;
#X msg 16 131 1;
#X obj 16 177 t f f f;
#X obj 16 198 sel 9;
#X msg 112 298 deststartchan 0 \, startchan \$1 \, bang;
#X msg 130 323 deststartchan 1 \, startchan \$1 \, bang;
#X obj 16 47 t b f b;
#X obj 82 358 fluid.bufcompose~ -destination nmfmatch_summed-bases
-destgain 1 -source nmfmatch_guit-bases -numchans 1;
#X msg 73 72 \; nmfmatch_summed-bases const;
#X connect 0 0 14 0;
#X connect 2 0 3 0;
#X connect 2 1 13 0;
#X connect 3 0 12 0;
#X connect 4 0 5 0;
#X connect 5 0 8 0;
#X connect 5 1 7 0;
#X connect 6 0 10 0;
#X connect 7 0 6 1;
#X connect 8 0 9 0;
#X connect 9 0 6 0;
#X connect 10 0 11 0;
#X connect 10 1 2 0;
#X connect 10 2 6 1;
#X connect 11 0 1 0;
#X connect 12 0 15 0;
#X connect 13 0 15 0;
#X connect 14 0 4 0;
#X connect 14 1 2 1;
#X connect 14 1 3 1;
#X connect 14 2 16 0;
#X restore 20 276 pd makenewbases;
#X obj 20 295 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144 -1
-1;
#X text 17 82 1) press to start the process of finding the pick component
like in the fluid.bufnmf~ help file, f 95;
#X obj 22 548 dac~;
#X obj 23 340 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144 -1
-1;
#X msg 46 340 stop;
#N canvas 512 268 1103 698 cool_delays 0;
#X obj 15 381 inlet~;
#X obj 273 287 outlet~;
#X obj 612 289 outlet~;
#X text 51 502 987Hz 0.15q 0.8gain;
#X text 358 495 1987Hz 0.15q 0.8gain;
#X text 744 496 1456Hz 0.15q 0.8gain;
#X obj 430 229 delread4~ \$0-centre 567;
#X obj 747 472 delwrite~ \$0-centre 567;
#X obj 430 249 *~ 0.6;
#X obj 430 285 *~ 0.3;
#X obj 75 64 osc~ 1;
#X obj 159 63 osc~ 4.09082;
#X obj 313 71 osc~ 2.93801;
#X obj 413 72 osc~ 2.37663;
#X obj 76 131 *~;
#X obj 239 128 *~;
#X obj 388 120 *~;
#X obj 70 229 delread4~ \$0-left 123;
#X obj 44 472 delwrite~ \$0-left 123;
#X obj 689 229 delread4~ \$0-right 345;
#X obj 358 469 delwrite~ \$0-right 345;
#X obj 76 152 +~ 122;
#X obj 239 149 +~ 566;
#X obj 388 141 +~ 344;
#X msg 851 292 clear;
#X obj 44 429 bp~ 987 0.15;
#X obj 358 429 bp~ 1987 0.15;
#X obj 747 429 bp~ 1456 0.15;
#X obj 747 451 *~ 0.4;
#X obj 359 449 *~ 0.4;
#X obj 44 450 *~ 0.4;
#X connect 0 0 25 0;
#X connect 0 0 26 0;
#X connect 0 0 27 0;
#X connect 6 0 8 0;
#X connect 8 0 1 0;
#X connect 8 0 2 0;
#X connect 8 0 9 0;
#X connect 9 0 25 0;
#X connect 9 0 26 0;
#X connect 10 0 14 0;
#X connect 10 0 15 0;
#X connect 11 0 14 1;
#X connect 12 0 15 1;
#X connect 12 0 16 0;
#X connect 13 0 16 1;
#X connect 14 0 21 0;
#X connect 15 0 22 0;
#X connect 16 0 23 0;
#X connect 17 0 1 0;
#X connect 17 0 26 0;
#X connect 19 0 2 0;
#X connect 19 0 25 0;
#X connect 19 0 27 0;
#X connect 21 0 17 0;
#X connect 22 0 6 0;
#X connect 23 0 19 0;
#X connect 24 0 25 0;
#X connect 24 0 26 0;
#X connect 24 0 27 0;
#X connect 25 0 30 0;
#X connect 26 0 29 0;
#X connect 27 0 28 0;
#X connect 28 0 7 0;
#X connect 29 0 20 0;
#X connect 30 0 18 0;
#X restore 59 520 pd cool_delays;
#X obj 19 736 clone multiarray 10 nmfmatch_guit-bases;
#X obj 19 757 clone multiarray 2 nmfmatch_summed-bases;
#X obj 19 778 clone multiarray 70 nmfmatch_guit-stats;
#X obj 275 735 clone multiarray 70 nmfmatch_guit-features;
#X obj 276 756 array define nmfmatch_guitar;
#X obj 276 777 clone multiarray 10 nmfmatch_guit-resynth;
#X msg 20 102 read -resize ../media/Tremblay-AaS-AcousticStrums-M.wav
nmfmatch_guitar;
#X obj 20 173 fluid.bufnmf~ -source nmfmatch_guitar -numframes 88200
-components 10 -bases nmfmatch_guit-bases -resynth nmfmatch_guit-resynth
-fftsettings 1024 256 2048, f 96;
#X obj 20 204 fluid.bufspectralshape~ -source nmfmatch_guit-resynth
-features nmfmatch_guit-features -fftsettings 1024 256 2048, f 86
;
#X obj 20 236 fluid.bufstats~ -source nmfmatch_guit-features -stats
nmfmatch_guit-stats, f 73;
#X obj 22 362 tabplay~ nmfmatch_guitar;
#X obj 194 393 fluid.nmfmatch~ 2 -bases nmfmatch_summed-bases -fftsettings
1024 256 2048, f 75;
#X obj 193 449 unpack f f;
#X floatatom 194 473 8 0 0 0 - - -;
#X floatatom 298 473 8 0 0 0 - - -;
#X obj 139 473 change;
#N canvas 497 102 703 467 cool_compressor 0;
#X obj 49 426 outlet~;
#X obj 233 109 inlet;
#X obj 46 76 delread~ #0-nmfmatch;
#X obj 49 382 *~;
#X obj 49 403 *~ 1;
#X obj 233 128 sig~;
#X obj 346 111 loadbang;
#X msg 339 139 256;
#X obj 234 242 /~;
#X obj 249 222 expr pow(10 \, ($f1 / 20));
#X obj 234 263 clip~ 1 1000;
#X obj 133 150 t b f;
#X msg 133 171 1;
#X obj 133 192 /, f 5;
#X obj 133 213 - 1;
#X obj 133 234 sig~;
#X obj 133 255 pow~;
#X obj 124 381 expr pow(10 \, ($f1 / 20));
#X obj 234 170 fexpr~ if($x > $y \, $y + (($x-$y) / $f2) \, $y + (($x-$y)
/ $f3)), f 62;
#X obj 46 53 r coolcomp-del;
#X obj 133 129 r coolcomp-ratio;
#X obj 249 204 r coolcomp-thresh;
#X obj 414 112 r coolcomp-att;
#X obj 598 125 r coolcomp-rel;
#X obj 125 363 r coolcomp-gain;
#X connect 1 0 5 0;
#X connect 2 0 3 0;
#X connect 3 0 4 0;
#X connect 4 0 0 0;
#X connect 5 0 18 0;
#X connect 6 0 7 0;
#X connect 7 0 18 1;
#X connect 7 0 18 2;
#X connect 8 0 10 0;
#X connect 9 0 8 1;
#X connect 10 0 16 1;
#X connect 11 0 12 0;
#X connect 11 1 13 1;
#X connect 12 0 13 0;
#X connect 13 0 14 0;
#X connect 14 0 15 0;
#X connect 15 0 16 0;
#X connect 16 0 3 1;
#X connect 17 0 4 1;
#X connect 18 0 8 0;
#X connect 19 0 2 0;
#X connect 20 0 11 0;
#X connect 21 0 9 0;
#X connect 22 0 18 1;
#X connect 23 0 18 2;
#X connect 24 0 17 0;
#X restore 59 501 pd cool_compressor;
#X msg 246 575 1 -180;
#X msg 246 593 90 -3;
#X msg 246 611 2 -3;
#X obj 40 395 delwrite~ #0-nmfmatch 20;
#X text 300 571 1: the dry guitar only \, 2: the guitar going 100%
in the delay. 3: to hear the effect of compressing the send to the
delay by the amount of pick found \, therefore not sending noisy attacks
in the long delay.;
#X text 243 555 3) select a compressor preset;
#X text 85 341 4) play the guitar;
#X text 42 295 2) wait for finishing. The basis with the highest centroid
is copied to the first channel, f 90;
#X text 16 13 control a compressor based on learned components;
#X text 193 490 pick amount;
#X text 297 491 body amount;
#X msg 231 639 \; coolcomp-del 12 \; coolcomp-att 200 \; coolcomp-rel
1300 \; coolcomp-ratio 8 \; coolcomp-thresh \$1 \; coolcomp-gain \$2
;
#X connect 0 0 1 0;
#X connect 1 0 17 0;
#X connect 2 0 3 0;
#X connect 3 0 4 0;
#X connect 7 0 20 0;
#X connect 8 0 20 0;
#X connect 9 0 6 0;
#X connect 9 1 6 1;
#X connect 16 0 0 0;
#X connect 17 0 18 0;
#X connect 18 0 19 0;
#X connect 19 0 2 0;
#X connect 20 0 6 0;
#X connect 20 0 6 1;
#X connect 20 0 21 0;
#X connect 20 0 30 0;
#X connect 21 0 22 0;
#X connect 22 0 23 0;
#X connect 22 0 25 0;
#X connect 22 1 24 0;
#X connect 25 0 26 0;
#X connect 26 0 9 0;
#X connect 27 0 38 0;
#X connect 28 0 38 0;
#X connect 29 0 38 0;
#X restore 459 756 pd example_1;
#N canvas 352 127 571 680 example_2 0;
#X restore 459 784 pd example_2;
#X text 34 100 Matches an incoming audio signal against a set of spectral
templates, f 69;
#X obj 37 398 fluid.bufnmf~ -source didact-source3 -bases nmfmatch_basis
-components 2, f 72;
#X msg 37 417 \; nmfmatch_basis-1 xticks 0 0 0 \; nmfmatch_basis-0
xticks 0 0 0;
#X obj 104 800 fluid.nmfmatch~ 2 -bases nmfmatch_basis;
#X obj 104 821 unpack f f;
#X floatatom 104 844 8 0 0 0 - - -;
#X floatatom 161 844 8 0 0 0 - - -;
#X text 174 822 output is a list of activation levels;
#X text 35 703 3) try matching one \, the other \, and both;
#X text 215 843 the activation levels grow in the presence of a learned
component, f 33;
#X connect 7 0 21 0;
#X connect 10 0 12 0;
#X connect 11 0 14 0;
#X connect 12 0 16 0;
#X connect 12 0 23 0;
#X connect 13 0 12 1;
#X connect 14 0 16 0;
#X connect 14 0 23 0;
#X connect 15 0 14 1;
#X connect 16 0 17 0;
#X connect 16 0 17 1;
#X connect 21 0 22 0;
#X connect 23 0 24 0;
#X connect 24 0 25 0;
#X connect 24 1 26 0;
