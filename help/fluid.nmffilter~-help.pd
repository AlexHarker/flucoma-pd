#N canvas 40 42 584 889 10;
#X obj 12 19 cnv 15 100 10 empty empty fluid.nmffilter~ 20 12 0 36
-262144 -66577 0;
#X text 457 719 more info:;
#X text 36 57 Real-Time Non-Negative Matrix Factorisation with Fixed
Bases, f 61;
#X text 34 100 Decomposes and resynthesises a signal against a set
of spectral templates, f 74;
#N canvas 0 22 450 278 (subpatch) 0;
#X array didact-source 88200 float 0;
#X coords 0 1 88199 -1 516 141 1 0 0;
#X restore 35 160 graph;
#N canvas 731 210 608 628 make_2_tones 0;
#X obj 39 101 array define hisine 44100;
#X msg 38 172 44100;
#X obj 57 220 until;
#X msg 125 241 -1;
#X msg 57 241 1;
#X obj 57 262 +;
#X obj 57 329 tabwrite lowsine;
#X obj 297 331 tabwrite hisine;
#X obj 57 283 t f f f f f, f 40;
#X obj 297 310 expr sin($f1 / 22050 * 3.14159 * 5000);
#X obj 38 193 t b f b;
#X obj 38 402 fluid.bufcompose~;
#X obj 38 153 loadbang;
#X obj 39 81 array define lowsine 44100;
#X msg 38 422 \; didact-source xticks 0 0 0;
#X msg 38 365 reset \, destgain 1 \, destination didact-source \, source
lowsine \, bang \, source hisine \, deststartframe 44100 \, bang;
#X obj 57 308 expr sin($f1 / 22050 * 3.14159 * 500);
#X connect 1 0 10 0;
#X connect 2 0 4 0;
#X connect 3 0 5 1;
#X connect 4 0 5 0;
#X connect 5 0 8 0;
#X connect 8 0 16 0;
#X connect 8 1 6 1;
#X connect 8 2 9 0;
#X connect 8 3 7 1;
#X connect 8 4 5 1;
#X connect 9 0 7 0;
#X connect 10 0 15 0;
#X connect 10 1 2 0;
#X connect 10 2 3 0;
#X connect 11 0 14 0;
#X connect 12 0 1 0;
#X connect 15 0 11 0;
#X connect 16 0 6 0;
#X restore 35 313 pd make_2_tones;
#N canvas 0 22 450 278 (subpatch) 0;
#X array nmffilter_basis-0 513 float 0;
#X coords 0 1 512 0 513 70 1 0 0;
#X restore 38 526 graph;
#N canvas 0 22 450 278 (subpatch) 0;
#X array nmffilter_basis-1 513 float 0;
#X coords 0 1 512 0 513 70 1 0 0;
#X restore 37 611 graph;
#X obj 37 380 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144 -1
-1;
#X obj 37 398 fluid.bufnmf~ -source didact-source -bases nmffilter_basis
-components 2, f 72;
#X msg 37 417 \; nmffilter_basis-1 xticks 0 0 0 \; nmffilter_basis-0
xticks 0 0 0;
#X text 65 379 1) decompose the 2 consecutive sines above in 2 components
with bufnmf~, f 74;
#X text 35 494 2) watch for clearly different bases - ideally a spike
each.;
#X obj 37 742 osc~ 500;
#X obj 98 741 osc~ 5000;
#X obj 37 799 *~;
#X obj 65 783 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X obj 97 799 *~;
#X obj 125 783 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X obj 218 799 *~;
#X obj 246 783 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X obj 140 826 *~ 0.1;
#X obj 140 847 dac~;
#X text 36 718 3) monitor the source \, and the decomposed components
;
#X obj 97 761 fluid.nmffilter~ 2 -bases nmffilter_basis;
#N canvas 280 113 620 604 example_1 0;
#X text 16 13 delay only low spectral centroid components;
#X obj 20 133 soundfiler;
#X obj 20 153 t b;
#N canvas 0 23 909 774 statsquery 0;
#X obj 118 150 list split 1;
#X obj 212 156 list length;
#X obj 152 170 t a;
#X obj 117 256 +;
#X msg 117 223 -1;
#X obj 215 300 tabread;
#X obj 117 202 t b b f;
#X msg 215 278 5;
#X obj 156 375 spigot;
#X obj 119 429 f;
#X obj 117 277 t f f f, f 14;
#X obj 117 298 sel 0;
#X obj 118 100 t a a b, f 38;
#X obj 230 409 spigot;
#X obj 215 321 t f f;
#X obj 118 54 inlet;
#X text 163 61 the channels where the centroids are= the first of every
7 (see fluid.bufstats~ help), f 85;
#X msg 118 79 0 7 14 21 28 35 42 49 56 63;
#X text -4 153 iterates backwards;
#X text 18 241 keeps the index;
#X text 269 301 reads the index of the median stats;
#X text 278 407 compares it- passes if larger \, and also stores the
index;
#X obj 119 450 outlet;
#X text 119 473 output the index of the largest;
#X msg 245 277 set nmffilter_guit-stats-\$1;
#X obj 243 351 <;
#X msg 375 320 1e+09;
#X connect 0 0 6 0;
#X connect 0 1 2 0;
#X connect 1 0 3 1;
#X connect 2 0 0 0;
#X connect 3 0 10 0;
#X connect 4 0 3 0;
#X connect 5 0 14 0;
#X connect 6 0 4 0;
#X connect 6 1 7 0;
#X connect 6 2 24 0;
#X connect 7 0 5 0;
#X connect 8 0 9 1;
#X connect 9 0 22 0;
#X connect 10 0 11 0;
#X connect 10 1 8 0;
#X connect 10 2 3 1;
#X connect 11 0 9 0;
#X connect 12 0 0 0;
#X connect 12 1 1 0;
#X connect 12 2 26 0;
#X connect 13 0 25 1;
#X connect 14 0 13 0;
#X connect 14 1 25 0;
#X connect 15 0 17 0;
#X connect 17 0 12 0;
#X connect 24 0 5 0;
#X connect 25 0 8 1;
#X connect 25 0 13 1;
#X connect 26 0 9 1;
#X connect 26 0 25 1;
#X restore 20 277 pd statsquery;
#N canvas 329 66 450 472 makenewbases 0;
#X obj 16 26 inlet;
#X obj 17 282 outlet;
#X obj 195 218 sel;
#X obj 162 257 f;
#X msg 16 68 10;
#X obj 16 89 t f b;
#X obj 16 156 +;
#X msg 79 130 -1;
#X obj 16 110 until;
#X msg 16 131 1;
#X obj 16 177 t f f f;
#X obj 16 198 sel 9;
#X msg 112 298 deststartchan 0 \, startchan \$1 \, bang;
#X msg 130 323 deststartchan 1 \, startchan \$1 \, bang;
#X obj 82 358 fluid.bufcompose~ -destination nmffilter_summed-bases
-destgain 1 -source nmffilter_guit-bases -numchans 1;
#X obj 16 47 t b f b;
#X msg 73 72 \; nmffilter_summed-bases const;
#X connect 0 0 15 0;
#X connect 2 0 3 0;
#X connect 2 1 13 0;
#X connect 3 0 12 0;
#X connect 4 0 5 0;
#X connect 5 0 8 0;
#X connect 5 1 7 0;
#X connect 6 0 10 0;
#X connect 7 0 6 1;
#X connect 8 0 9 0;
#X connect 9 0 6 0;
#X connect 10 0 11 0;
#X connect 10 1 2 0;
#X connect 10 2 6 1;
#X connect 11 0 1 0;
#X connect 12 0 14 0;
#X connect 13 0 14 0;
#X connect 15 0 4 0;
#X connect 15 1 2 1;
#X connect 15 1 3 1;
#X connect 15 2 16 0;
#X restore 20 297 pd makenewbases;
#X obj 20 317 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144 -1
-1;
#X msg 20 102 read -resize ../media/Tremblay-AaS-AcousticStrums-M.wav
nmffilter_guitar;
#X obj 20 173 fluid.bufnmf~ -source nmffilter_guitar -numframes 88200
-components 10 -bases nmffilter_guit-bases -resynth nmffilter_guit-resynth
-fftsettings 1024 256 2048;
#X obj 20 215 fluid.bufspectralshape~ -source nmffilter_guit-resynth
-features nmffilter_guit-features -fftsettings 1024 256 2048;
#X obj 20 246 fluid.bufstats~ -source nmffilter_guit-features -stats
nmffilter_guit-stats;
#X obj 22 514 clone multiarray 10 nmffilter_guit-bases;
#X obj 279 534 array define nmffilter_guitar;
#X obj 278 513 clone multiarray 70 nmffilter_guit-features;
#X obj 279 555 clone multiarray 10 nmffilter_guit-resynth;
#X obj 22 556 clone multiarray 70 nmffilter_guit-stats;
#X obj 22 535 clone multiarray 2 nmffilter_summed-bases;
#X text 17 82 1) press to start the process of finding the pick component
like in the fluid.bufnmf~ help file, f 95;
#X text 42 317 2) wait for finishing. The basis with the lowest centroid
is copied to the first channel, f 88;
#X obj 21 403 tabplay~ nmffilter_guitar;
#X obj 51 429 fluid.nmffilter~ 2 -bases nmffilter_summed-bases -fftsettings
1024 256 2048, f 75;
#X obj 23 476 dac~;
#X obj 21 381 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144 -1
-1;
#X msg 44 381 stop;
#N canvas 512 268 1103 698 cool_delays 0;
#X obj 15 381 inlet~;
#X obj 273 287 outlet~;
#X obj 612 289 outlet~;
#X text 51 502 987Hz 0.15q 0.8gain;
#X text 358 495 1987Hz 0.15q 0.8gain;
#X text 744 496 1456Hz 0.15q 0.8gain;
#X obj 430 229 delread4~ \$0-centre 567;
#X obj 747 472 delwrite~ \$0-centre 567;
#X obj 430 249 *~ 0.6;
#X obj 430 285 *~ 0.3;
#X obj 75 64 osc~ 1;
#X obj 159 63 osc~ 4.09082;
#X obj 313 71 osc~ 2.93801;
#X obj 413 72 osc~ 2.37663;
#X obj 76 131 *~;
#X obj 239 128 *~;
#X obj 388 120 *~;
#X obj 70 229 delread4~ \$0-left 123;
#X obj 44 472 delwrite~ \$0-left 123;
#X obj 689 229 delread4~ \$0-right 345;
#X obj 358 469 delwrite~ \$0-right 345;
#X obj 76 152 +~ 122;
#X obj 239 149 +~ 566;
#X obj 388 141 +~ 344;
#X msg 851 292 clear;
#X obj 44 429 bp~ 987 0.15;
#X obj 358 429 bp~ 1987 0.15;
#X obj 747 429 bp~ 1456 0.15;
#X obj 747 451 *~ 0.4;
#X obj 359 449 *~ 0.4;
#X obj 44 450 *~ 0.4;
#X connect 0 0 25 0;
#X connect 0 0 26 0;
#X connect 0 0 27 0;
#X connect 6 0 8 0;
#X connect 8 0 1 0;
#X connect 8 0 2 0;
#X connect 8 0 9 0;
#X connect 9 0 25 0;
#X connect 9 0 26 0;
#X connect 10 0 14 0;
#X connect 10 0 15 0;
#X connect 11 0 14 1;
#X connect 12 0 15 1;
#X connect 12 0 16 0;
#X connect 13 0 16 1;
#X connect 14 0 21 0;
#X connect 15 0 22 0;
#X connect 16 0 23 0;
#X connect 17 0 1 0;
#X connect 17 0 26 0;
#X connect 19 0 2 0;
#X connect 19 0 25 0;
#X connect 19 0 27 0;
#X connect 21 0 17 0;
#X connect 22 0 6 0;
#X connect 23 0 19 0;
#X connect 24 0 25 0;
#X connect 24 0 26 0;
#X connect 24 0 27 0;
#X connect 25 0 30 0;
#X connect 26 0 29 0;
#X connect 27 0 28 0;
#X connect 28 0 7 0;
#X connect 29 0 20 0;
#X connect 30 0 18 0;
#X restore 51 450 pd cool_delays;
#X text 82 383 play the sound - the lowest component is delayed;
#X connect 1 0 2 0;
#X connect 2 0 7 0;
#X connect 3 0 4 0;
#X connect 4 0 5 0;
#X connect 6 0 1 0;
#X connect 7 0 8 0;
#X connect 8 0 9 0;
#X connect 9 0 3 0;
#X connect 18 0 19 0;
#X connect 18 0 20 0;
#X connect 18 0 20 1;
#X connect 19 0 23 0;
#X connect 21 0 18 0;
#X connect 22 0 18 0;
#X connect 23 0 20 0;
#X connect 23 1 20 1;
#X restore 459 756 pd example_1;
#N canvas 352 127 571 680 example_2 0;
#X text 17 18 extract components on the fly and process separately
;
#X obj 21 68 loadbang;
#X obj 21 110 soundfiler;
#X obj 188 108 array define nmffilter_drums;
#X msg 21 89 read -resize ../media/Nicol-LoopE-M.wav nmffilter_drums
;
#X obj 22 229 *~, f 10;
#X obj 22 189 /~;
#X msg 21 160 1;
#X obj 22 210 phasor~;
#X obj 80 152 samplerate~;
#X obj 65 170 / 1;
#X obj 21 130 t b f b;
#X obj 163 654 dac~;
#X obj 22 249 tabread~ nmffilter_drums;
#X obj 60 291 tabwrite~ nmffilter_circular;
#X obj 223 257 metro 1000;
#X obj 223 234 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X obj 188 128 array define nmffilter_circular 44100;
#X obj 188 148 clone multiarray 3 nmffilter_bases1;
#X obj 188 168 clone multiarray 3 nmffilter_bases0;
#X obj 52 351 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144 -1
-1;
#X obj 52 371 int;
#X obj 52 390 == 0;
#X msg 52 429 bases nmffilter_bases\$1 \, bang;
#X obj 52 409 t f f f;
#X obj 52 483 int;
#X obj 52 450 fluid.bufnmf~ -source nmffilter_circular -fftsettings
1024 256 2048 -iterations 50 -components 3;
#X msg 52 502 bases nmffilter_bases\$1;
#X obj 24 534 fluid.nmffilter~ 3 -fftsettings 1024 256 2048;
#X obj 208 605 expr~ tanh($v1 * 10) * 0.15;
#N canvas 696 53 753 436 cheap_reverb 0;
#X obj 43 237 inlet~;
#X obj 80 191 outlet~;
#X obj 382 188 outlet~;
#X obj 43 258 *~ 3;
#X obj 80 156 delread4~ \$0-leftrev;
#X obj 396 156 delread4~ \$0-rightrev;
#X obj 214 156 delread4~ \$0-leftrev;
#X obj 530 156 delread4~ \$0-rightrev;
#X obj 530 95 osc~ 0.097;
#X obj 530 116 *~ 1.2;
#X obj 530 137 +~ 34.4;
#X obj 397 95 osc~ 0.111;
#X obj 397 116 *~ 2;
#X obj 397 137 +~ 23.4;
#X obj 214 116 *~ 2;
#X obj 81 116 *~ 2;
#X obj 214 95 osc~ 0.105;
#X obj 214 137 +~ 34.5;
#X obj 81 137 +~ 43.5;
#X obj 81 95 osc~ 0.1;
#X obj 211 338 delwrite~ \$0-rightrev 36.7;
#X obj 43 339 delwrite~ \$0-leftrev 45.6;
#X obj 43 318 bp~ 1500 0.5;
#X obj 211 316 bp~ 1450 0.4;
#X obj 43 297 *~ 0.15;
#X obj 211 295 *~ 0.12;
#X connect 0 0 3 0;
#X connect 3 0 24 0;
#X connect 3 0 25 0;
#X connect 4 0 1 0;
#X connect 4 0 25 0;
#X connect 5 0 1 0;
#X connect 5 0 24 0;
#X connect 6 0 2 0;
#X connect 6 0 25 0;
#X connect 7 0 2 0;
#X connect 7 0 24 0;
#X connect 8 0 9 0;
#X connect 9 0 10 0;
#X connect 10 0 7 0;
#X connect 11 0 12 0;
#X connect 12 0 13 0;
#X connect 13 0 5 0;
#X connect 14 0 17 0;
#X connect 15 0 18 0;
#X connect 16 0 14 0;
#X connect 17 0 6 0;
#X connect 18 0 4 0;
#X connect 19 0 15 0;
#X connect 22 0 21 0;
#X connect 23 0 20 0;
#X connect 24 0 22 0;
#X connect 25 0 23 0;
#X restore 20 606 pd cheap_reverb;
#X text 246 234 1) start a circular buffer recorder on the input;
#X text 84 347 2) After at least one second \, click here to process
the last second of sound \, extracting 3 complementary spectra;
#X obj 162 635 *~;
#X obj 186 635 *~;
#X obj 386 606 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X text 387 587 3) unmute the audio;
#X connect 1 0 4 0;
#X connect 2 0 11 0;
#X connect 4 0 2 0;
#X connect 5 0 13 0;
#X connect 6 0 8 0;
#X connect 7 0 6 0;
#X connect 8 0 5 0;
#X connect 9 0 10 1;
#X connect 10 0 6 1;
#X connect 11 0 7 0;
#X connect 11 1 5 1;
#X connect 11 1 10 0;
#X connect 11 2 9 0;
#X connect 13 0 14 0;
#X connect 13 0 28 0;
#X connect 15 0 14 0;
#X connect 16 0 15 0;
#X connect 20 0 21 0;
#X connect 21 0 22 0;
#X connect 22 0 24 0;
#X connect 23 0 26 0;
#X connect 24 0 23 0;
#X connect 24 1 25 1;
#X connect 24 2 21 1;
#X connect 25 0 27 0;
#X connect 26 0 25 0;
#X connect 27 0 28 0;
#X connect 28 0 30 0;
#X connect 28 0 33 0;
#X connect 28 0 34 0;
#X connect 28 1 33 0;
#X connect 28 2 29 0;
#X connect 29 0 34 0;
#X connect 30 0 33 0;
#X connect 30 1 34 0;
#X connect 33 0 12 0;
#X connect 34 0 12 1;
#X connect 35 0 34 1;
#X connect 35 0 33 1;
#X restore 459 784 pd example_2;
#X connect 8 0 9 0;
#X connect 9 0 10 0;
#X connect 13 0 15 0;
#X connect 13 0 24 0;
#X connect 14 0 15 0;
#X connect 14 0 24 0;
#X connect 15 0 21 0;
#X connect 16 0 15 1;
#X connect 17 0 21 0;
#X connect 18 0 17 1;
#X connect 19 0 21 0;
#X connect 20 0 19 1;
#X connect 21 0 22 0;
#X connect 21 0 22 1;
#X connect 24 0 17 0;
#X connect 24 1 19 0;
